'use strict';

function loadCssCode(code) {
  const style = document.createElement('style');
  style.type = 'text/css';
  style.rel = 'stylesheet';
  try {
    //for Chrome Firefox Opera Safari
    style.appendChild(document.createTextNode(code));
  } catch (ex) {
    //for IE
    style.styleSheet.cssText = code;
  }
  const head = document.getElementsByTagName('head')[0];
  head.appendChild(style);
}

function setStyle(ele, obj) {
  const STYLE = 'style';
  const styleArr = [];
  const arr = Object.entries(obj);

  for (const [key, val] of arr) {
    styleArr.push(`${key}:${val};`);
  }

  // window.__GushiwenDelads__.Element.readerControls = ele;
  let styleStr = ele.getAttribute(STYLE);
  styleStr += styleArr.join('');
  ele.setAttribute(STYLE, styleStr);
}

function checkIsTarget() {
  const isTarget = [
    'shiwenv_',
    'authorv_'
  ].some(str => location.pathname.includes(str));

  return isTarget;
}

const BTN_TEXT = '展开';
const getLeftContent = () => document.querySelector(".main3 .left");

function modifyBtnStyle() {
  const moreBtnArr = Array.from(getLeftContent().querySelectorAll('.contyishang a')).filter(it => it.innerText.includes(BTN_TEXT));
  for (const it of moreBtnArr) {
    setStyle(it, {
      width: '100%'
    });
  }
}

function getCssOfDelCommonAds() {
  return [
    `#threeWeixin2 {
      z-index: -100
    }`,
    `.main3 .left {
      width: 100%;
      clear: left;
      float: left;
    }`,
    `.main3 .right, .main3 .right div {
      width: 0 !important;
      height: 0 !important;
      overflow: hidden;
    }`,
    `#btmwx {
      width: 0 !important;
      height: 0 !important;
    }`
  ].join('');
}

function getCssOfDelalter () {
  return [
    `#threeWeixin2 {
      z-index: -100
    }`,
    `.main3 .right .abcd div {
      width: 0 !important;
      height: 0 !important;
      overflow: hidden;
    }`
  ];
}

function main() {
  if (!checkIsTarget()) {
    return;
  }

  console.info('Hello GushiwenDelads!');

  loadCssCode([
    getCssOfDelCommonAds(),
    getCssOfDelalter()
  ].join(''));

  window.onload = function() {
    modifyBtnStyle();
  };
}

// ==UserScript==
// @name         GushiwenDelads
// @namespace    http://tampermonkey.net/
// @version      1.0.0
// @description  适用于古诗文网，tampermonkey的去广告脚本
// @author       You
// @match        https://so.gushiwen.cn/*
// @grant        none
// @license      https://github.com/isaaxite/tampermonkey-gusiwen_delads/blob/main/LICENSE
// ==/UserScript==


(function() {
  main();
})();
